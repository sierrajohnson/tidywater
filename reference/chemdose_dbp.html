<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate DBP formation — chemdose_dbp • tidywater</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate DBP formation — chemdose_dbp"><meta name="description" content="Calculates disinfection byproduct (DBP) formation based on the U.S. EPA's
Water Treatment Plant Model (U.S. EPA, 2001). Required arguments include an object of class &quot;water&quot;
created by define_water chlorine dose, type, reaction time, and treatment applied (if any).
The function also requires additional water quality parameters defined in define_water
including bromide, TOC, UV254, temperature, and pH.
For a single water use chemdose_dbp; for a dataframe use chemdose_dbp_df.
Use pluck_cols = TRUE to get values from the output water as new dataframe columns.
For most arguments in the _df helper
&quot;use_col&quot; default looks for a column of the same name in the dataframe. The argument can be specified directly in the
function instead or an unquoted column name can be provided."><meta property="og:description" content="Calculates disinfection byproduct (DBP) formation based on the U.S. EPA's
Water Treatment Plant Model (U.S. EPA, 2001). Required arguments include an object of class &quot;water&quot;
created by define_water chlorine dose, type, reaction time, and treatment applied (if any).
The function also requires additional water quality parameters defined in define_water
including bromide, TOC, UV254, temperature, and pH.
For a single water use chemdose_dbp; for a dataframe use chemdose_dbp_df.
Use pluck_cols = TRUE to get values from the output water as new dataframe columns.
For most arguments in the _df helper
&quot;use_col&quot; default looks for a column of the same name in the dataframe. The argument can be specified directly in the
function instead or an unquoted column name can be provided."><meta property="og:image" content="https://BrownandCaldwell-Public.github.io/tidywater/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tidywater</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.10.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/tidywater.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/coeff_fitting_chemdose_dbp.html">Fitting and using custom coefficients in chemdose_dbp</a></li>
    <li><a class="dropdown-item" href="../articles/help_functions_blend_waters.html">Blending Multiple Waters</a></li>
    <li><a class="dropdown-item" href="../articles/help_functions_chemdose_ph.html">Helper Functions &amp; Dose Chemicals</a></li>
    <li><a class="dropdown-item" href="../articles/intro.html">Introduction to tidywater: Basic functions</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/BrownandCaldwell-Public/tidywater/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Calculate DBP formation</h1>
      <small class="dont-index">Source: <a href="https://github.com/BrownandCaldwell-Public/tidywater/blob/main/R/chemdose_dbp.R" class="external-link"><code>R/chemdose_dbp.R</code></a></small>
      <div class="d-none name"><code>chemdose_dbp.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculates disinfection byproduct (DBP) formation based on the U.S. EPA's
Water Treatment Plant Model (U.S. EPA, 2001). Required arguments include an object of class "water"
created by <a href="define_water.html">define_water</a> chlorine dose, type, reaction time, and treatment applied (if any).
The function also requires additional water quality parameters defined in <a href="define_water.html">define_water</a>
including bromide, TOC, UV254, temperature, and pH.</p>
<p>For a single water use <code>chemdose_dbp</code>; for a dataframe use <code>chemdose_dbp_df</code>.
Use <code>pluck_cols = TRUE</code> to get values from the output water as new dataframe columns.
For most arguments in the <code>_df</code> helper
"use_col" default looks for a column of the same name in the dataframe. The argument can be specified directly in the
function instead or an unquoted column name can be provided.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">chemdose_dbp</span><span class="op">(</span></span>
<span>  <span class="va">water</span>,</span>
<span>  <span class="va">cl2</span>,</span>
<span>  <span class="va">time</span>,</span>
<span>  treatment <span class="op">=</span> <span class="st">"raw"</span>,</span>
<span>  cl_type <span class="op">=</span> <span class="st">"chorine"</span>,</span>
<span>  location <span class="op">=</span> <span class="st">"plant"</span>,</span>
<span>  correction <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  coeff <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">chemdose_dbp_df</span><span class="op">(</span></span>
<span>  <span class="va">df</span>,</span>
<span>  input_water <span class="op">=</span> <span class="st">"defined"</span>,</span>
<span>  output_water <span class="op">=</span> <span class="st">"disinfected"</span>,</span>
<span>  pluck_cols <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  water_prefix <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  cl2 <span class="op">=</span> <span class="st">"use_col"</span>,</span>
<span>  time <span class="op">=</span> <span class="st">"use_col"</span>,</span>
<span>  treatment <span class="op">=</span> <span class="st">"use_col"</span>,</span>
<span>  cl_type <span class="op">=</span> <span class="st">"use_col"</span>,</span>
<span>  location <span class="op">=</span> <span class="st">"use_col"</span>,</span>
<span>  correction <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  coeff <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="source">Source<a class="anchor" aria-label="anchor" href="#source"></a></h2>
    <p>TTHMs, raw: U.S. EPA (2001) equation 5-131</p>
<p>HAAs, raw: U.S. EPA (2001) equation 5-134</p>
<p>TTHMs, treated: U.S. EPA (2001) equation 5-139</p>
<p>HAAs, treated: U.S. EPA (2001) equation 5-142</p>
<p>See references list at: <a href="https://github.com/BrownandCaldwell-Public/tidywater/wiki/References" class="external-link">https://github.com/BrownandCaldwell-Public/tidywater/wiki/References</a></p>
    </div>
    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-water">water<a class="anchor" aria-label="anchor" href="#arg-water"></a></dt>
<dd><p>Source water object of class "water" created by <code><a href="define_water.html">define_water</a></code></p></dd>


<dt id="arg-cl-">cl2<a class="anchor" aria-label="anchor" href="#arg-cl-"></a></dt>
<dd><p>Applied chlorine dose (mg/L as Cl2). Model results are valid for doses between 1.51 and 33.55 mg/L.</p></dd>


<dt id="arg-time">time<a class="anchor" aria-label="anchor" href="#arg-time"></a></dt>
<dd><p>Reaction time (hours). Model results are valid for reaction times between 2 and 168 hours.</p></dd>


<dt id="arg-treatment">treatment<a class="anchor" aria-label="anchor" href="#arg-treatment"></a></dt>
<dd><p>Type of treatment applied to the water. Options include "raw" for no treatment (default), "coag" for
water that has been coagulated or softened, and "gac" for water that has been treated by granular activated carbon (GAC).
GAC treatment has also been used for estimating formation after membrane treatment with good results.</p></dd>


<dt id="arg-cl-type">cl_type<a class="anchor" aria-label="anchor" href="#arg-cl-type"></a></dt>
<dd><p>Type of chlorination applied, either "chlorine" (default) or "chloramine".</p></dd>


<dt id="arg-location">location<a class="anchor" aria-label="anchor" href="#arg-location"></a></dt>
<dd><p>Location for DBP formation, either in the "plant" (default), or in the distributions system, "ds".</p></dd>


<dt id="arg-correction">correction<a class="anchor" aria-label="anchor" href="#arg-correction"></a></dt>
<dd><p>Model calculations are adjusted based on location and cl_type. Default value is TRUE.</p></dd>


<dt id="arg-coeff">coeff<a class="anchor" aria-label="anchor" href="#arg-coeff"></a></dt>
<dd><p>Optional input to specify custom coefficients to the dbp model. Must be a data frame with the following columns:
ID, and the corresponding coefficients A, a, b, c, d, e, f, and ph_const for each dbp of interest. Default value is NULL.</p></dd>


<dt id="arg-df">df<a class="anchor" aria-label="anchor" href="#arg-df"></a></dt>
<dd><p>a data frame containing a water class column, which has already been computed using
<a href="define_water.html">define_water</a>. The df may include columns for the other function arguments.</p></dd>


<dt id="arg-input-water">input_water<a class="anchor" aria-label="anchor" href="#arg-input-water"></a></dt>
<dd><p>name of the column of water class data to be used as the input for this function. Default is "defined".</p></dd>


<dt id="arg-output-water">output_water<a class="anchor" aria-label="anchor" href="#arg-output-water"></a></dt>
<dd><p>name of the output column storing updated water class object. Default is "disinfected".</p></dd>


<dt id="arg-pluck-cols">pluck_cols<a class="anchor" aria-label="anchor" href="#arg-pluck-cols"></a></dt>
<dd><p>Extract primary water slots modified by the function (tthm, haa5) into new numeric columns for easy access with TRUE.
Alternatively, specify "all" to get all DBP species in addition: (tthm, chcl3, chcl2br, chbr2cl, chbr3, haa5, mcaa, dcaa, tcaa, mbaa, dbaa)
Defaults to FALSE.</p></dd>


<dt id="arg-water-prefix">water_prefix<a class="anchor" aria-label="anchor" href="#arg-water-prefix"></a></dt>
<dd><p>Append the output_water name to the start of the plucked columns. Default is TRUE.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>chemdose_dbp</code> returns a single water class object with predicted DBP concentrations.</p>
<p><code>chemdose_dbp_df</code> returns a data frame containing a water class column with updated tthm, chcl3, chcl2br, chbr2cl, chbr3, haa5, mcaa, dcaa, tcaa, mbaa, dbaa
concentrations. Optionally, it also adds columns for those slots individually.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function will calculate haloacetic acids (HAA) as HAA5, and total trihalomethanes (TTHM).
Use <code>summarize_wq(water, params = c("dbps"))</code> to quickly tabulate the results.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">example_dbp</span> <span class="op">&lt;-</span> <span class="fu"><a href="define_water.html">define_water</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">20</span>, <span class="fl">66</span>, toc <span class="op">=</span> <span class="fl">4</span>, uv254 <span class="op">=</span> <span class="fl">.2</span>, br <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">chemdose_dbp</span><span class="op">(</span>cl2 <span class="op">=</span> <span class="fl">2</span>, time <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Missing value for DOC. Default value of 95% of TOC will be used.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Major ions missing and neither TDS or conductivity entered. Ideal conditions will be assumed. Ionic strength will be set to NA and activity coefficients in future calculations will be set to 1.</span>
<span class="r-in"><span><span class="va">example_dbp</span> <span class="op">&lt;-</span> <span class="fu"><a href="define_water.html">define_water</a></span><span class="op">(</span><span class="fl">7.5</span>, <span class="fl">20</span>, <span class="fl">66</span>, toc <span class="op">=</span> <span class="fl">4</span>, uv254 <span class="op">=</span> <span class="fl">.2</span>, br <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">chemdose_dbp</span><span class="op">(</span>cl2 <span class="op">=</span> <span class="fl">3</span>, time <span class="op">=</span> <span class="fl">168</span>, treatment <span class="op">=</span> <span class="st">"coag"</span>, location <span class="op">=</span> <span class="st">"ds"</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Missing value for DOC. Default value of 95% of TOC will be used.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Major ions missing and neither TDS or conductivity entered. Ideal conditions will be assumed. Ionic strength will be set to NA and activity coefficients in future calculations will be set to 1.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="va">example_df</span> <span class="op">&lt;-</span> <span class="va">water_df</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>br <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="define_water_df.html">define_water_df</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">chemdose_dbp_df</span><span class="op">(</span>input_water <span class="op">=</span> <span class="st">"defined"</span>, cl2 <span class="op">=</span> <span class="fl">4</span>, time <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">example_df</span> <span class="op">&lt;-</span> <span class="va">water_df</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>br <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="define_water_df.html">define_water_df</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    cl2_dose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    time <span class="op">=</span> <span class="fl">30</span></span></span>
<span class="r-in"><span>  <span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">chemdose_dbp_df</span><span class="op">(</span></span></span>
<span class="r-in"><span>    cl2 <span class="op">=</span> <span class="va">cl2_dose</span>, treatment <span class="op">=</span> <span class="st">"coag"</span>, location <span class="op">=</span> <span class="st">"ds"</span>,</span></span>
<span class="r-in"><span>    cl_type <span class="op">=</span> <span class="st">"chloramine"</span>, pluck_cols <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Temperature is outside the model bounds of temp=20 Celsius for coagulated water.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>pH is outside the model bounds of pH = 7.5 for coagulated water</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>pH is outside the model bounds of pH = 7.5 for coagulated water</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Temperature is outside the model bounds of temp=20 Celsius for coagulated water.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>pH is outside the model bounds of pH = 7.5 for coagulated water</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sierra Johnson, Libby McKenna, Riley Mulhern, Chris Corwin, Brown and Caldwell.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

